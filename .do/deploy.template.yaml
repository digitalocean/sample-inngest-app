spec:
  name: nextjs-inngest-sampleapp
  region: nyc
  services:
    - name: web
      image:
        registry_type: DOCR
        repository: htmxreg/inngest-sampleapp
        digest: "sha256:b2b7fc6823fa311f9fe64a3e323790c6f632de15bd909c85b5ee3cb46036a43f"
      http_port: 3000
      # Distroless final image has entrypoint=node; command is the script:
      run_command: >-
        server.js
      instance_size_slug: apps-d-2vcpu-4gb
      instance_count: 2
      routes:
        - path: /

      envs:
        # Bind to DO's provided port
        - key: PORT
          scope: RUN_AND_BUILD_TIME
          value: "3000"

        # Inngest client config
        - key: INNGEST_APP_ID
          scope: RUN_AND_BUILD_TIME
          value: nextjs-inngest-sampleApp

        - key: INNGEST_APP_NAME
          scope: RUN_AND_BUILD_TIME
          value: Next+Inngest+DO+App

        # Required if you call inngest.send() from the server
        - key: INNGEST_EVENT_KEY
          scope: RUN_AND_BUILD_TIME
          type: SECRET

        # Required for verifying signed requests from Inngest to /api/inngest
        - key: INNGEST_SIGNING_KEY
          scope: RUN_AND_BUILD_TIME
          type: SECRET
